var $event = $.event,
    $special,
    resizeTimeout;
var Grid;

$special = $event.special.debouncedresize = {
    setup: function() {
        $(this).on("resize", $special.handler);
    },
    teardown: function() {
        $(this).off("resize", $special.handler);
    },
    handler: function(event, execAsap) {
        // Save the context
        var context = this,
            args = arguments,
            dispatch = function() {
                // set correct event type
                event.type = "debouncedresize";
                $event.dispatch.apply(context, args);
            };

        if (resizeTimeout) {
            clearTimeout(resizeTimeout);
        }

        execAsap ?
            dispatch() :
            resizeTimeout = setTimeout(dispatch, $special.threshold);
    },
    threshold: 250
};

// ======================= imagesLoaded Plugin ===============================
// https://github.com/desandro/imagesloaded

// $('#my-container').imagesLoaded(myFunction)
// execute a callback when all images have loaded.
// needed because .load() doesn't work on cached images

// callback function gets image collection as argument
//  this is the container

// original: MIT license. Paul Irish. 2010.
// contributors: Oren Solomianik, David DeSandro, Yiannis Chatzikonstantinou

// blank image data-uri bypasses webkit log warning (thx doug jones)
var BLANK = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';

$.fn.imagesLoaded = function(callback) {
    var $this = this,
        deferred = $.isFunction($.Deferred) ? $.Deferred() : 0,
        hasNotify = $.isFunction(deferred.notify),
        $images = $this.find('img').add($this.filter('img')),
        loaded = [],
        proper = [],
        broken = [];

    // Register deferred callbacks
    if ($.isPlainObject(callback)) {
        $.each(callback, function(key, value) {
            if (key === 'callback') {
                callback = value;
            } else if (deferred) {
                deferred[key](value);
            }
        });
    }

    function doneLoading() {
        var $proper = $(proper),
            $broken = $(broken);

        if (deferred) {
            if (broken.length) {
                deferred.reject($images, $proper, $broken);
            } else {
                deferred.resolve($images);
            }
        }

        if ($.isFunction(callback)) {
            callback.call($this, $images, $proper, $broken);
        }
    }

    function imgLoaded(img, isBroken) {
        // don't proceed if BLANK image, or image is already loaded
        if (img.src === BLANK || $.inArray(img, loaded) !== -1) {
            return;
        }

        // store element in loaded images array
        loaded.push(img);

        // keep track of broken and properly loaded images
        if (isBroken) {
            broken.push(img);
        } else {
            proper.push(img);
        }

        // cache image and its state for future calls
        $.data(img, 'imagesLoaded', {isBroken: isBroken, src: img.src});

        // trigger deferred progress method if present
        if (hasNotify) {
            deferred.notifyWith($(img), [isBroken, $images, $(proper), $(broken)]);
        }

        // call doneLoading and clean listeners if all images are loaded
        if ($images.length === loaded.length) {
            setTimeout(doneLoading);
            $images.unbind('.imagesLoaded');
        }
    }

    // if no images, trigger immediately
    if (!$images.length) {
        doneLoading();
    } else {
        $images.bind('load.imagesLoaded error.imagesLoaded', function(event) {
            // trigger imgLoaded
            imgLoaded(event.target, event.type === 'error');
        }).each(function(i, el) {
            var src = el.src;

            // find out if this image has been already checked for status
            // if it was, and src has not changed, call imgLoaded on it
            var cached = $.data(el, 'imagesLoaded');
            if (cached && cached.src === src) {
                imgLoaded(el, cached.isBroken);
                return;
            }

            // if complete is true and browser supports natural sizes, try
            // to check for image status manually
            if (el.complete && el.naturalWidth !== undefined) {
                imgLoaded(el, el.naturalWidth === 0 || el.naturalHeight === 0);
                return;
            }

            // cached images don't fire load sometimes, so we reset src, but only when
            // dealing with IE, or image is complete (loaded) and failed manual check
            // webkit hack from http://groups.google.com/group/jquery-dev/browse_thread/thread/eee6ab7b2da50e1f
            if (el.readyState || el.complete) {
                el.src = BLANK;
                el.src = src;
            }
        });
    }

    return deferred ? deferred.promise($this) : $this;
};

if ($('.divspeakers').length > 0) {
    Grid = (function() {
        // list of items
        var $grid = $('.divspeakers'),
            // the items
            $items = $grid.find('.speaker-preview'),
            // current expanded item's index
            current = -1,
            // position (top) of the expanded item
            // used to know if the preview will expand in a different row
            previewPos = -1,
            // extra amount of pixels to scroll the window
            scrollExtra = 0,
            // extra margin when expanded (between preview overlay and the next items)
            marginExpanded = 10,
            $window = $(window), winsize,
            $body = $('html, body'),
            // transitionend events
            transEndEventNames = {
                'WebkitTransition': 'webkitTransitionEnd',
                'MozTransition': 'transitionend',
                'OTransition': 'oTransitionEnd',
                'msTransition': 'MSTransitionEnd',
                'transition': 'transitionend'
            },
            transEndEventName = transEndEventNames[Modernizr.prefixed('transition')],
            // support for csstransitions
            support = Modernizr.csstransitions,
            // default settings
            settings = {
                minHeight: 700,
                speed: 350,
                easing: 'ease'
            };

        function init(config) {

            // the settings..
            settings = $.extend(true, {}, settings, config);

            // preload all images
            $grid.imagesLoaded(function() {

                // save item´s size and offset
                saveItemInfo(true);
                // get window´s size
                getWinSize();
                // initialize some events
                initEvents();

            });

        }

        function destroy() {
            $items.each(function() {
                var $item = $(this);
                $item.off();
                $item.children('a').off();
            });

        }

        function hidePreviews() {
            $items.each(function() {
                hidePreview(false);
            });
        }

        function updateItems() {
            hidePreview(false);

            destroy();

            $items = $grid.find('.speaker-preview');

            saveItemInfo(true);
            initItemsEvents($items);

        }

        // saves the item´s offset top and height (if saveheight is true)
        function saveItemInfo(saveheight) {
            $items.each(function() {
                var $item = $(this);
                $item.data('offsetTop', $item.offset().top);
                if (saveheight) {
                    $item.data('height', $item.height());
                }
            });
        }

        function initEvents() {

            // when clicking an item, show the preview with the item´s info and large image.
            // close the item if already expanded.
            // also close if clicking on the item´s cross
            initItemsEvents($items);

            // on window resize get the window´s size again
            // reset some values..
            $window.on('debouncedresize', function() {

                scrollExtra = 0;
                previewPos = -1;
                // save item´s offset
                saveItemInfo();
                getWinSize();
                var preview = $.data(this, 'preview');
                if (typeof preview !== 'undefined') {
                    hidePreview(true);
                }

            });

        }

        function initItemsEvents($items) {
            $items.on('click', 'span.close', function() {
                hidePreview(true);
                return false;
            });

            $items.children('a').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                var $item = $(this).parent();
                // check if item already opened
                current === $item.index() ? hidePreview(true) : showPreview($item);
                return false;
            });
        }

        function getWinSize() {
            winsize = {width: $window.width(), height: $window.height()};
        }

        function showPreview($item) {
            var preview = $.data(this, 'preview'),
                // item´s offset top
                position = $item.data('offsetTop');

            scrollExtra = 0;
            // if a preview exists and previewPos is different (different row) from item´s top then close it
            if (typeof preview !== 'undefined') {

                // not in the same row
                if (previewPos !== position) {
                    // if position > previewPos then we need to take te current preview´s height in consideration when scrolling the window
                    if (position > previewPos) {
                        scrollExtra = preview.height;
                    }
                    hidePreview(true);
                }
                // same row
                else {
                    preview.update($item);
                    return false;
                }

            }
            // update previewPos
            previewPos = position;
            // initialize new preview for the clicked item
            preview = $.data(this, 'preview', new Preview($item));
            // expand preview overlay
            preview.open();

        }

        function hidePreview(animated) {
            current = -1;
            var preview = $.data(this, 'preview');
            if (preview) preview.close(animated);
            $.removeData(this, 'preview');
        }

        // the preview obj / overlay
        function Preview($item) {
            this.$item = $item;
            this.expandedIdx = this.$item.index();
            this.create();
            this.update();
        }

        Preview.prototype = {
            create: function() {
                // create Preview structure:
                this.$title = $('<h3 class="speaker-title"></h3>');
                this.$description = $('<p class="speaker-description push"></p>');
                this.$href = $('<a class="btn-speaker" href="#" target="_blank">Купить мастер-класс</a>');
                this.$webinar = $('<a class="btn-speaker" href="#" target="_blank">Вебинарная комната</a>');
                this.$about = $('<h6 class="speaker-about-title">О спикере</h6>');
                this.$aboutinfo = $('<p class="speaker-about milli push"></p>');
                this.$materials = $('<p class="milli speaker-materials">Список материалов и инструментов, необходимых для выполнения мастер-классов, вы сможете найти в вебинарной комнате. </p>');
                this.$details = $('<div class="speaker-details"></div>').append(this.$title, this.$description, this.$about, this.$aboutinfo, this.$materials, this.$href, this.$webinar);
                this.$loading = $('<div class="spinner"></div>');
                this.$fullimage = $('<div class="speaker-fullimg"></div>').append(this.$loading);
                this.$closePreview = $('<span class="material-icons close tera"><i class="fa fa-times" aria-hidden="true"></i></span>');
                this.$previewInner = $('<div class="speaker-expander-inner"></div>').append(this.$closePreview, this.$fullimage, this.$details);
                this.$previewEl = $('<div class="speaker-expander"></div>').append(this.$previewInner);
                // append preview element to the item
                this.$item.append(this.getEl());
                // set the transitions for the preview and the item
                if (support) {
                    this.setTransition();
                }
            },
            calcHeight: function() {
                var heightPreview = settings.minHeight,
                    itemHeight = heightPreview + this.$item.data('height') + marginExpanded;

                //if (heightPreview < settings.minHeight) {
                //    heightPreview = settings.minHeight;
                //    itemHeight    = settings.minHeight + this.$item.data('height') + marginExpanded;
                //}

                this.height = heightPreview;
                this.itemHeight = itemHeight;

            },
            setHeights: function() {

                var self = this,
                    onEndFn = function() {
                        if (support) {
                            self.$item.off(transEndEventName);
                        }
                        self.$item.addClass('speaker-expanded');
                    };

                this.calcHeight();
                this.$previewEl.css('height', this.height);
                this.$item.css('height', this.itemHeight).on(transEndEventName, onEndFn);

                if (!support) {
                    onEndFn.call();
                }

            },
            update: function($item) {
                if ($item) {
                    this.$item = $item;
                }

                // if already expanded remove class "speaker-expanded" from current item and add it to new item
                if (current !== -1) {
                    var $currentItem = $items.eq(current);
                    $currentItem.removeClass('speaker-expanded');
                    this.$item.addClass('speaker-expanded');
                    // position the preview correctly
                    this.positionPreview();
                }

                // update current value
                current = this.$item.index();

                // update preview´s content
                var $itemEl = this.$item.children('a'),
                    eldata = {
                        href: $itemEl.attr('href'),
                        sell: $itemEl.data('sell'),
                        webinar: $itemEl.data('webinar'),
                        largesrc: $itemEl.data('largesrc'),
                        title: $itemEl.data('title'),
                        description: $itemEl.data('description'),
                        aboutinfo: $itemEl.data('about')
                    }
                ;

                this.$title.html(eldata.title);
                this.$description.html(eldata.description);

                if (eldata.sell != '') {
                    this.$href.attr('href', eldata.href);
                    this.$href.show();
                } else {
                    this.$href.hide();
                }
                if (eldata.webinar != '') {
                    this.$webinar.show();
                    this.$webinar.attr('href', eldata.webinar);
                } else {
                    this.$webinar.hide();
                }
                this.$aboutinfo.html(eldata.aboutinfo);
                this.$details.liQuotes();
                var self = this;

                // remove the current image in the preview
                if (typeof self.$largeImg !== 'undefined') {
                    self.$largeImg.remove();
                }

                // preload large image and add it to the preview
                // for smaller screens we don´t display the large image (the media query will hide the fullimage wrapper)
                if (self.$fullimage.is(':visible')) {
                    this.$loading.show();
                    $('<img/>').load(function() {
                        var $img = $(this);
                        if ($img.attr('src') === self.$item.children('a').data('largesrc')) {
                            self.$loading.hide();
                            self.$fullimage.find('img').remove();
                            self.$largeImg = $img.fadeIn(350);
                            self.$fullimage.append(self.$largeImg);
                        }
                    }).attr('src', eldata.largesrc);
                }
            },
            open: function() {

                setTimeout($.proxy(function() {
                    // set the height for the preview and the item
                    this.setHeights();
                    // scroll to position the preview in the right place
                    this.positionPreview();
                }, this), 25);

            },
            close: function(animated) {
                var self = this,
                    onEndFn = function() {
                        if (support) {
                            $(this).off(transEndEventName);
                        }
                        self.$item.removeClass('speaker-expanded');
                        self.$previewEl.remove();
                    };

                if (!animated) {
                    this.setTransition(0);
                    self.$item.removeClass('speaker-expanded');
                }

                setTimeout($.proxy(function() {

                    if (animated && typeof this.$largeImg !== 'undefined') {
                        this.$largeImg.fadeOut('fast');
                    }
                    this.$previewEl.css('height', 0);
                    // the current expanded item (might be different from this.$item)
                    var $expandedItem = $items.eq(this.expandedIdx);
                    $expandedItem.css('height', $expandedItem.data('height')).on(transEndEventName, onEndFn);

                    if (!support) {
                        onEndFn.call();
                    }

                }, this), animated ? 25 : 0);

                return false;

            },
            positionPreview: function() {

                // scroll page
                // case 1 : preview height + item height fits in window´s height
                // case 2 : preview height + item height does not fit in window´s height and preview height is smaller than window´s height
                // case 3 : preview height + item height does not fit in window´s height and preview height is bigger than window´s height
                var position = this.$item.data('offsetTop'),
                    previewOffsetT = this.$previewEl.offset().top - scrollExtra,
                    scrollVal = this.height + this.$item.data('height') + marginExpanded <= winsize.height ? position : this.height < winsize.height ? previewOffsetT - ( winsize.height - this.height ) : previewOffsetT;

                $body.animate({scrollTop: scrollVal}, settings.speed);

            },
            setTransition: function(speed) {
                this.$previewEl.css('transition', 'height ' + (speed === 0 ? speed : settings.speed) + 'ms ' + settings.easing);
                this.$item.css('transition', 'height ' + (speed === 0 ? speed : settings.speed) + 'ms ' + settings.easing);
            },
            getEl: function() {
                return this.$previewEl;
            }
        };

        function removeStyle() {
            $(this).removeAttr('style');
            alert('dsdd');
        }

        return {
            init: init,
            updateItems: updateItems,
            hidePreviews: hidePreviews
        };

    })();
}

$(document).ready(function() {

    "use strict";


    /* =================================
     LOADER
     =================================== */
// makes sure the whole site is loaded
    $(window).on('load', function() {

        // will first fade out the loading animation
        $(".loader-inner").fadeOut();
        // will fade out the whole DIV that covers the website.
        $(".loader").fadeOut("slow");

    });


    /* =================================
     NAVBAR COLLAPSE ON SCROLL
     =================================== */
    $(window).on('scroll', function() {
        var b = $(window).scrollTop();
        if (b > 60) {
            $(".navbar").addClass("top-nav-collapse");
        } else {
            $(".navbar").removeClass("top-nav-collapse");
        }
    });


    /* =================================
     NAVBAR WITH TOP BAR
     =================================== */
    $('.nav-2').affix({
        offset: {
            top: $('.top-bar').height()
        }
    });


    /* ===========================================================
     PAGE SCROLLING FEATURE
     ============================================================== */
    $('a.smooth-scroll').on('click', function(event) {
        var $anchor = $(this);
        $('html, body').stop().animate({
            scrollTop: $($anchor.attr('href')).offset().top + 20
        }, 1500, 'easeInOutExpo');
        event.preventDefault();
    });


    /* ===========================================================
     DYNAMIC PRICING TABLE
     ============================================================== */
    $('.package-toggle').each(function() {
        $(this).change(function() {
            var curr_class = '.' + $(this).attr('id');
            var price = $(this).attr('data-price');
            var price_box = $('.pricing-table li.price span');

            $(curr_class).toggleClass('active');

            if (price) {
                if ($(curr_class).hasClass('active')) {
                    price_box.html(parseInt(price_box.html(), 10) + parseInt(price, 10));
                }
                else {
                    price_box.html(parseInt(price_box.html(), 10) - parseInt(price, 10));
                }
            }
        });
    });


    /* ===========================================================
     BACK TO TOP BUTTON
     ============================================================== */
    var offset = 300,
//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
        offset_opacity = 1200,
//duration of the top scrolling animation (in ms)
        scroll_top_duration = 700,
//grab the "back to top" link
        $back_to_top = $('.top');

//hide or show the "back to top" link
    $(window).on('scroll', function() {
        ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('is-visible') : $back_to_top.removeClass('is-visible fade-out');
        if ($(this).scrollTop() > offset_opacity) {
            $back_to_top.addClass('fade-out');
        }
    });

//smooth scroll to top
    $back_to_top.on('click', function(event) {
        event.preventDefault();
        $('body,html').animate({
                scrollTop: 0
            }, scroll_top_duration
        );
    });


    /* ===========================================================
     WOW ANIMATIONS
     ============================================================== */
    new WOW().init();


    /* ===========================================================
     HIDE MOBILE MENU AFTER CLICKING
     ============================================================== */
    $('.navbar-nav>li>a:not(#dLabel)').on('click', function() {
        $('#navbar-collapse').removeClass("in").addClass("collapse");
    });


    /* ===========================================================
     VIDEO BACKGROUND
     ============================================================== */
    $('.video-play').vide("images/video/video", {
        posterType: "jpg"
    });


    /* ===========================================================
     MAGNIFIC POPUP
     ============================================================== */
    $('.mp-singleimg').magnificPopup({
        type: 'image'
    });

    $('.mp-gallery').magnificPopup({
        type: 'image',
        gallery: {enabled: true},
    });

    $('.mp-iframe').magnificPopup({
        type: 'iframe'
    });


    /* ===========================================================
     FUNFACTS COUNTER
     ============================================================== */
    if ($('.counter').length) {
        var o = $('.counter'),
            cc = 1;

        $(window).on('scroll', function() {
            var elemPos = o.offset().top,
                elemPosBottom = o.offset().top + o.height(),
                winHeight = $(window).height(),
                scrollToElem = elemPos - winHeight,
                winScrollTop = $(this).scrollTop();

            if (winScrollTop > scrollToElem) {
                if (elemPosBottom > winScrollTop) {
                    if (cc < 2) {
                        cc = cc + 2;
                        o.countTo();
                    }
                }
            }
        });
    }


    /* ===========================================================
     FEATURES TAB
     ============================================================== */
    $('.features-tab .tab-title').on('click', function(e) {
        if (!$(this).hasClass('current')) {
            $('.tab-title').removeClass('out');
            $('.tab-title.current').addClass('out');
            $('.features-tab .tab-title').removeClass('current');
            $(this).addClass('current');
        }
        e.preventDefault();
    });


    /* ===========================================================
     FEATURES TAB - SCROLLING TO THE TAB-TITLE ON MOBILE DEVICES
     ==============================================================  */
    var mQ = window.matchMedia('(max-width: 767px)');
    mQ.addListener(tabScrolling);

    function tabScrolling(mQ) {
        if (mQ.matches) {
            $('.features-tab .tab-title').on('click', function(event) {
                var $anchor = $(this);
                $('html, body').stop().animate({
                    scrollTop: $anchor.offset().top - 90
                }, 500, 'easeInOutExpo');
                event.preventDefault();
            });
        }
    }

    tabScrolling(mQ);


    /* ===========================================================
     TWITTER FEED
     ============================================================== */
    /*
    function handleTweets(tweets) {
        var x = tweets.length,
            n = 0,
            element = document.getElementById('twitter-feed'),
            html = '<div class="slides">';
        while (n < x) {
            html += '<div>' + tweets[n] + '</div>';
            n++;
        }
        html += '</div>';
        element.innerHTML = html;
*/
        /* Twits attached to owl-carousel */
    /*
        $("#twitter-feed .slides").owlCarousel({
            slideSpeed: 300,
            paginationSpeed: 400,
            autoPlay: true,
            pagination: false,
            transitionStyle: "fade",
            singleItem: true
        });
    }

    if ($('#twitter-feed').length) {

        var config_feed = {
            "profile": {"screenName": 'envato'},
            "domId": 'twitter-feed',
            "maxTweets": 5,
            "enableLinks": true,
            "showUser": false,
            "showTime": true,
            "dateFunction": '',
            "showRetweet": false,
            "customCallback": handleTweets,
            "showInteraction": false
        };

        twitterFetcher.fetch(config_feed);
    }
    */


    /* ===========================================================
     TWITTER WIDGET FOR TESTIMONIALS
     ============================================================== */
    /*
    window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);
        t._e = [];
        t.ready = function(f) {
            t._e.push(f);
        };
        return t;
    }(document, "script", "twitter-wjs"));
    */

    /* ===========================================================
     COUNTDOWN TIMER
     ============================================================== */
    if ($('.countdown').length) {
        $(".countdown").each(function() {
            $(this).jCounter({
                date: $(this).attr("data-counter"), // Deadline date
                timezone: "Europe/Moscow",
                format: "dd:hh:mm:ss",
                twoDigits: 'on',
                //serverDateSource: "php/dateandtime.php",
                fallback: function() {
                }
            });
        });
    }

    /* ===========================================================
     MAILCHIMP
     ============================================================== */
    if ($('#mailchimpForm').length) {
        $("#mailchimpForm").formchimp();
    }


    /* ===========================================================
     GOOGLE MAPS
     ============================================================== */
    /* active mouse scroll when the user clicks into the map*/
    if ($('.map-container').length) {
        $('.map-container').on('click', function() {
            $('.map-iframe').css("pointer-events", "auto");
        });

        $(".map-container").on('mouseleave', function() {
            $('.map-iframe').css("pointer-events", "none");
        });
    }


    /* ==========================================
     FUNCTION FOR EMAIL ADDRESS VALIDATION
     ============================================= */
    function isValidEmail(emailAddress) {
        var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
        return pattern.test(emailAddress);
    }


    /* ==========================================
     FUNCTION FOR PHONE NUMBER VALIDATION
     ============================================= */
    function isValidPhoneNumber(phoneNumber) {
        return phoneNumber.match(/[0-9-()+]{3,20}/);
    }


    /* ==========================================
     CONTACT FORM
     ============================================= */
    $("#contactForm").on('submit', function(e) {

        e.preventDefault();
        var data = {
            name: $("#cfName").val(),
            email: $("#cfEmail").val(),
            subject: $("#cfSubject").val(),
            message: $("#cfMessage").val()
        };

        if (isValidEmail(data['email']) && (data['message'].length > 1) && (data['name'].length > 1) && (data['subject'].length > 1)) {
            $.ajax({
                type: "POST",
                url: "php/contact.php",
                data: data,
                success: function() {
                    $('.success.cf').delay(500).fadeIn(1000);
                    $('.failed.cf').fadeOut(500);
                }
            });
        } else {
            $('.failed.cf').delay(500).fadeIn(1000);
            $('.success.cf').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     CALLBACK FORM
     ============================================= */
    $("#callbackForm").on('submit', function(e) {
        e.preventDefault();
        var data = {
            name: $("#cbName").val(),
            email: $("#cbEmail").val(),
            phone: $("#cbPhone").val()
        };

        if (isValidEmail(data['email']) && (data['name'].length > 1) && isValidPhoneNumber(data['phone'])) {
            $.ajax({
                type: "POST",
                url: "php/callback.php",
                data: data,
                success: function() {
                    $('.success.cb').delay(500).fadeIn(1000);
                    $('.failed.cb').fadeOut(500);
                }
            });
        } else {
            $('.failed.cb').delay(500).fadeIn(1000);
            $('.success.cb').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     TICKET SELECTION
     ============================================= */
    var $ticketSelected = $('.ticket-selection .item-price');

    $ticketSelected.on('click', function(event) {
        $ticketSelected.removeClass('active');
        $(this).addClass('active');

        $('#ticketForm input[name="ticket"]').val($(this).find('h4').text() + ' Ticket - Cost: ' + $(this).find('.amount').text());
    });


    /* ==========================================
     TICKET FORM
     ============================================= */
    $("#ticketForm").on('submit', function(e) {
        e.preventDefault();
        var data = {
            name: $("#tfName").val(),
            email: $("#tfEmail").val(),
            phone: $("#tfPhone").val(),
            ticket: $("#tfTicket").val()
        };

        if (isValidEmail(data['email']) && (data['name'].length > 1) && (data['ticket'].length > 1) && isValidPhoneNumber(data['phone'])) {
            $.ajax({
                type: "POST",
                url: "php/ticket.php",
                data: data,
                success: function() {
                    $('.success.tf').delay(500).fadeIn(1000);
                    $('.failed.tf').fadeOut(500);
                }
            });
        } else {
            $('.failed.tf').delay(500).fadeIn(1000);
            $('.success.tf').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     QUOTE FORM
     ============================================= */
    $("#quoteForm").on('submit', function(e) {
        e.preventDefault();
        var data = {
            name: $("#qName").val(),
            email: $("#qEmail").val(),
            phone: $("#qPhone").val(),
            message: $("#qMessage").val()
        };

        if (isValidEmail(data['email']) && (data['name'].length > 1) && (data['message'].length > 1) && isValidPhoneNumber(data['phone'])) {
            $.ajax({
                type: "POST",
                url: "php/quote.php",
                data: data,
                success: function() {
                    $('.success.qf').delay(500).fadeIn(1000);
                    $('.failed.qf').fadeOut(500);
                }
            });
        } else {
            $('.failed.qf').delay(500).fadeIn(1000);
            $('.success.qf').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     DATEPICKER
     ============================================= */
    if ($("#dfDate").length) {
        $('#dfDate').pickadate({
            min: new Date()
        });
    }


    /* ==========================================
     APPOINTMENT WITH DATEPICKER FORM
     ============================================= */
    $("#dateForm").on('submit', function(e) {
        e.preventDefault();
        var data = {
            name: $("#dfName").val(),
            email: $("#dfEmail").val(),
            phone: $("#dfPhone").val(),
            date: $("#dfDate").val(),
            message: $("#dfMessage").val()
        };

        if (isValidEmail(data['email']) && (data['name'].length > 1) && (data['date'].length > 1) && (data['message'].length > 1) && isValidPhoneNumber(data['phone'])) {
            $.ajax({
                type: "POST",
                url: "php/appointment.php",
                data: data,
                success: function() {
                    $('.success.df').delay(500).fadeIn(1000);
                    $('.failed.df').fadeOut(500);
                }
            });
        } else {
            $('.failed.df').delay(500).fadeIn(1000);
            $('.success.df').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     SUBSCRIBE FORM / ONLY EMAIL
     ============================================= */
    $("#subscribeForm").on('submit', function(e) {
        e.preventDefault();
        var data = {
            email: $("#sfEmail").val()
        };

        if (isValidEmail(data['email'])) {
            $.ajax({
                type: "POST",
                url: "php/subscribe.php",
                data: data,
                success: function() {
                    $('.success.sf').delay(500).fadeIn(1000);
                    $('.failed.sf').fadeOut(500);
                }
            });
        } else {
            $('.failed.sf').delay(500).fadeIn(1000);
            $('.success.sf').fadeOut(500);
        }

        return false;
    });


    /* ==========================================
     SUBSCRIBE FORM 2 / EMAIL + NAME
     ============================================= */
    $("#subscribeForm2").on('submit', function(e) {
        e.preventDefault();
        var data = {
            name: $("#sf2Name").val(),
            email: $("#sf2Email").val()
        };

        if (isValidEmail(data['email']) && (data['name'].length > 1)) {
            $.ajax({
                type: "POST",
                url: "php/subscribe2.php",
                data: data,
                success: function() {
                    $('.success.sf2').delay(500).fadeIn(1000);
                    $('.failed.sf2').fadeOut(500);
                }
            });
        } else {
            $('.failed.sf2').delay(500).fadeIn(1000);
            $('.success.sf2').fadeOut(500);
        }

        return false;
    });


    /* ===========================================================
     BOOTSTRAP FIX FOR IE10 in Windows 8 and Windows Phone 8
     ============================================================== */
    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        var msViewportStyle = document.createElement('style');
        msViewportStyle.appendChild(
            document.createTextNode(
                '@-ms-viewport{width:auto!important}'
            )
        );
        document.querySelector('head').appendChild(msViewportStyle);
    }

    var mmixer;

    if ($('.divspeakers').length > 0 && !top.lpageUrl) {
        setTimeout(function() {
            Grid.init();
            //Sorting
            mmixer = mixitup(".divspeakers", {
                callbacks: {
                    onMixStart: function() {
                        Grid.hidePreviews();
                    },
                    onMixEnd: function() {
                        Grid.updateItems();
                    }
                },
                selectors: {
                    target: '.speaker-preview'
                },
                animation: {
                    enable: true,
                    duration: 600,
                    effects: 'stagger(30ms) fade',
                    easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
                }
            });//End of MixItUp Sorting
        }, 500);

        jQuery.fn.liQuotes = function() {
            return this.each(function() {
                htmlreplace($(this));
                function htmlreplace(element) {
                    if (!element) element = document.body;
                    var nodes = $(element).contents().each(function() {
                        if (this.nodeType == Node.TEXT_NODE) {
                            var result = $(this).text().replace(/\x27/g, '\x22').replace(/(\w)\x22(\w)/g, '$1\x27$2').replace(/(^)\x22(\s)/g, '$1&raquo;$2').replace(/(^|\s|\()"/g, "$1&laquo;").replace(/"(\;|\!|\?|\:|\.|\,|$|\)|\s)/g, "&raquo;$1")
                            $(this).after(result).remove();
                        } else {
                            htmlreplace(this);
                        }
                    });
                }
            });
        };
    }

}); // End $(document).ready Function
